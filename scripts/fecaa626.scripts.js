"use strict";angular.module("taskTracerApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","taskTracerApp.services","taskTracerApp.taskHelper"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("taskTracerApp.services",[]).value("Datastorage",{tasks:[],storeData:function(){localStorage.setItem("task-tracer-data",angular.toJson(this.tasks,!1))},loadData:function(){return this.tasks=angular.fromJson(localStorage.getItem("task-tracer-data")),null==this.tasks&&(this.tasks=[]),this.tasks}}),angular.module("taskTracerApp").controller("MainCtrl",["$scope","$http","$sce","Datastorage","Taskhelper",function(a,b,c,d,e){var f=new Date,g=new Date;g.setDate(g.getDate()-14);var h=d3.time.day.range(g,new Date);h.reverse(),a.tasks=d.loadData(),a.calculateTaskList=function(){a.taskDays=[],a.todos=[];for(var b in h){var c=h[b],d=parseInt(e.dayOfTheWeekFormat(c),10);if(d>0&&6>d){var f={date:c,dateString:e.dayFormat(c),tasks:[]};a.taskDays.push(f)}}for(var g in a.tasks){var i=a.tasks[g];if(i.startDate)for(var b in a.taskDays)a.taskDays[b].dateString==i.startDate&&a.taskDays[b].tasks.push(i);else a.todos.push(i)}},a.calculateTaskList(),a.showAddTask=function(a){return a==e.dayFormat(f)},a.addTodo=function(b,c){e.addTask({subtasks:a.tasks},c,b),a.todoText="",a.calculateTaskList()},a.deleteSubTask=function(b){e.removeTask(b,a.tasks),a.calculateTaskList()}}]),angular.module("taskTracerApp").directive("task",function(){return{templateUrl:"views/task.html",restrict:"E",scope:{task:"=",remove:"&onRemove"},controller:["$scope","Datastorage","Taskhelper",function(a,b,c){a.saveChanges=function(){c.updateTask(a.task)},a.addSubTask=function(){c.addTask(a.task,"")},a.deleteSubTask=function(b){c.removeTask(b,a.task.subtasks)}}],link:function(){}}}),angular.module("taskTracerApp").directive("subtask",["$compile",function(a){return{replace:!0,restrict:"E",scope:{task:"=",remove:"&onRemove"},template:"<div></div>",link:function(b,c){c.append("<task task='task' on-remove='remove()'></task>"),a(c.contents())(b)}}}]);var URL_REGEXP=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;angular.module("taskTracerApp.taskHelper",["taskTracerApp.services"]).factory("Taskhelper",["Datastorage",function(a){var b={dayOfTheWeekFormat:d3.time.format("%w"),dayFormat:d3.time.format("%m/%d/%Y"),removeTask:function(b,c){var d=c.indexOf(b);c.splice(d,1),a.storeData()},updateTask:function(b){var c=b.text;if(URL_REGEXP.test(c)){b.url=c;var d=c.lastIndexOf("/"),e=c.substring(d+1);b.text=e}a.storeData()},addTask:function(a,b,c){null==a.subtasks&&(a.subtasks=[]);var d={text:b,done:!1};angular.isString(c)&&(d.startDate=c),a.subtasks.push(d),this.updateTask(d)}};return b}]);